<form name="checkStep2Form" class="ng-hide" ng-show="!checkStep || checkStep == 2" ng-submit="forward(3)">
<h2>Create Assertions</h2>
<p>Define the conditions required for this check to pass. Your response and request are shown for context.</p>
<br />

<div ng-repeat="assertion in check.assertions" ng-init="assertionIndex = $index">
  <div class="row">
    <div class="col-xs-1"><div class="assertion-counter" ng-class="{success: assertionPassing(assertionIndex) == true, danger: assertionPassing(assertionIndex) == false && assertion.relationship}">
      {{assertionIndex+1}}
      <div class="assertion-validation" ng-class="{active: assertion.relationship}">
        <svg class="assertion-icon success" ng-show="assertionPassing(assertionIndex) == true" class="" viewBox="0 0 24 24"><use xlink:href="#ico_checkmark" /></svg>
        <svg class="assertion-icon danger" ng-show="assertionPassing(assertionIndex) == false" class="" viewBox="0 0 24 24"><use xlink:href="#ico_close" /></svg>
      </div>
    </div></div>
    <div class="col-xs-11 col-sm-4">
      <div class="form-group" dropdown is-open="status['assertionType'+$index]">
        <select class="sr-only" ng-required="true" ng-model="check.assertions[$index].type" ng-options="r for r in assertionTypes"></select>
        <button type="button" class="btn btn-block dropdown-toggle" dropdown-toggle ng-disabled="disabled" title="{{assertion.type.title || 'Pick your assertion type.'}}">
          {{assertion.type.name || 'Type'}} <svg class="icon" viewBox="0 0 24 24"><use xlink:href="#ico_caret_down" /></svg>
        </button>
        <ul class="dropdown-menu">
          <li ng-repeat="type in assertionTypes">
            <a href="#" ng-click="changeAssertionType(type,assertionIndex)" title="{{type.title}}">
              {{type.name}}
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="col-xs-11 col-xs-offset-1 col-sm-7 col-sm-offset-0">
      <div class="form-group" dropdown is-open="status['assertionRelationship'+$index]">
        <select class="sr-only" ng-required="true" ng-model="assertion.relationship" ng-options="r for r in relationships"></select>
        <button type="button" class="btn btn-block dropdown-toggle" dropdown-toggle ng-disabled="disabled" title="{{assertion.relationship.title || 'Pick your relationship'}}">
          {{assertion.relationship.name || 'Relationship'}} <svg class="icon" viewBox="0 0 24 24"><use xlink:href="#ico_caret_down" /></svg>
        </button>
        <ul class="dropdown-menu">
          <li ng-repeat="relationship in relationships">
            <a href="#" ng-click="changeAssertionRelationship(relationship,assertion)" title="{{relationship.title}}">
              {{relationship.name}}
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row">
    <div ng-if="assertion.relationship.name && assertion.type.name == 'Response Body'">
      <div class="col-xs-11 col-xs-offset-1">
        <div class="form-group">
          <input type="text" ng-model="assertion.value" placeholder="Value" class="form-control" ng-required="true" ng-if="!assertion.relationship.name.match('Is Empty|Is Not Empty')"/>
          <label>Value</label>
        </div>
      </div>
    </div>
    <div ng-if="assertion.relationship.name && assertion.type.name == 'Header'">
      <div class="col-xs-4 col-xs-offset-1">
        <div class="form-group">
          <input type="text" ng-model="assertion.value.name" typeahead="h as h[0] for h in checkResponse.responseHeaders | filter:$viewValue" class="form-control" placeholder="Key">
          <label>Key</label>
        </div>
      </div>
      <div class="col-xs-7">
        <div class="form-group">
          <input type="text" ng-model="assertion.value.value" typeahead="h as h[1] for h in checkResponse.responseHeaders | filter:$viewValue" class="form-control" placeholder="Value" ng-if="!assertion.relationship.name.match('Is Empty|Is Not Empty')">
          <label>Value</label>
        </div>
      </div>
    </div>
    <div ng-if="assertion.relationship.name && assertion.type.name == 'Status Code'">
      <div class="col-xs-11 col-xs-offset-1">
        <div class="form-group">
          <input type="text" ng-model="assertion.value" typeahead="c.code as c.code for c in codes | filter:$viewValue" class="form-control" placeholder="Code" ng-required="true" ng-if="!assertion.relationship.name.match('Is Empty|Is Not Empty')">
          <label>Code</label>
        </div>
      </div>
    </div>
    <div class="col-xs-11 col-xs-offset-1">
      <button type="button" class="btn btn-flat btn-nopad btn-danger" ng-click="check.removeItem('assertions',assertionIndex,'Remove this assertion?')" ng-hide="assertionIndex === 0" analytics-on analytics-event="assertion-remove" analytics-category="Checks"><svg class="icon" viewBox="0 0 24 24"><use xlink:href="#ico_delete" /></svg> Remove</button>
    </div>
  </div>
  <br />
</div>

<div class="row">
  <div class="col-xs-12">
    <div class="form-group">
      <button type="button" class="btn btn-flat btn-nopad btn-primary" ng-click="check.addItem('assertions')" analytics-on analytics-event="assertion-add" analytics-category="Checks"><svg class="icon" viewBox="0 0 24 24"><use xlink:href="#ico_add" /></svg> Add Another Assertion</button>
    </div>
  </div>
</div>
<br />

<div class="row">
  <div class="col-xs-12">
    <div class="form-group">
      <button type="submit" class="btn btn-raised btn-success btn-block" ng-disabled="checkStep1Form.$invalid">
        <span ng-if="creating">Actions &amp; Settings</span>
        <span ng-if="!creating">Save</span>
      </button>
    </div>
  </div>
</div>
<br />
<br />

<div class="row">
  <div class="col-xs-12">

    <h2>Your Response & Request</h2>
    <p>We're including the content of your response and your request to help you define assertions.</p>
    <br/>

    <tabset>
      <tab heading="Headers">
        <br>
        <table class="table">
          <tr>
            <td><strong><code>Status Code</code></strong></td>
            <td><code>{{checkResponse.status}} - {{checkResponse.statusText}}</code></td>
          </tr>
          <tr ng-repeat="h in checkResponse.responseHeaders">
            <td><strong><code>{{h[0]}}</code></strong></h4></td>
            <td><code>{{h[1]}}</code></td>
          </tr>
        </table>
      </tab>
      <tab heading="Body">
        <br>
        <div hljs source="checkResponse.dataString" language="{{checkResponse.language}}">
        </div>
      </tab>
      <tab heading="Request">
        <br>
        <table class="table">
          <tr>
            <td><strong><code>URL</code></strong></td>
            <td><code>{{checkResponse.config.url}}</code></td>
          </tr>
          <tr>
            <td><strong><code>Verb</code></strong></td>
            <td><code>{{checkResponse.config.method}}</code></td>
          </tr>
          <tr>
            <td colspan="2"><strong><code>Headers</code></strong></td>
          </tr>
          <tr ng-repeat="(key,val) in checkResponse.config.headers">
            <td><strong><code>{{key}}</code></strong></td>
            <td><code>{{val}}</code></td>
          </tr>
        </table>
      </tab>
    </tabset>
  </div>
</div>
</form>